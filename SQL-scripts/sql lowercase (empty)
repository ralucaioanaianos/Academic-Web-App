-- This script was generated by a beta version of the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public."course"
(
    cid integer NOT NULL,
    name varchar NOT NULL,
    fid integer NOT NULL,
    year integer NOT NULL,
    teacher varchar,
    semester integer,
    "maxstudents" integer NOT NULL,
    CONSTRAINT "course_pkey" PRIMARY KEY (cid)
);

CREATE TABLE IF NOT EXISTS public."faculty"
(
    fid integer NOT NULL,
    name varchar NOT NULL,
    "noyears" integer NOT NULL,
    chief varchar,
    CONSTRAINT "faculty_pkey" PRIMARY KEY (fid)
);

CREATE TABLE IF NOT EXISTS public."grade"
(
    "gradevalue" integer NOT NULL,
    username varchar NOT NULL,
    cid integer NOT NULL,
    CONSTRAINT "grade_pkey" PRIMARY KEY (username, cid)
);

CREATE TABLE IF NOT EXISTS public."group"
(
    gid integer NOT NULL,
    faculty integer NOT NULL,
    year integer NOT NULL,
    CONSTRAINT "group_pkey" PRIMARY KEY (gid)
);

CREATE TABLE IF NOT EXISTS public."optional course"
(
    cid integer NOT NULL,
    username varchar,
    CONSTRAINT "optional course_pkey" PRIMARY KEY (cid)
);

CREATE TABLE IF NOT EXISTS public."optional course enrollment"
(
    username varchar NOT NULL,
    cid integer NOT NULL,
    CONSTRAINT "optional course enrollment_pkey" PRIMARY KEY (username)
);

CREATE TABLE IF NOT EXISTS public."staff"
(
    username varchar NOT NULL,
    name varchar NOT NULL,
    CONSTRAINT "staff_pkey" PRIMARY KEY (username)
);

CREATE TABLE IF NOT EXISTS public."student"
(
    name varchar NOT NULL,
    username varchar NOT NULL,
    group1 integer NOT NULL,
    group2 integer,
    CONSTRAINT "student_pkey" PRIMARY KEY (username)
);

CREATE TABLE IF NOT EXISTS public."studentenrollment "
(
    username varchar NOT NULL,
    fid integer NOT NULL,
    year integer NOT NULL,
    CONSTRAINT "studentenrollment _pkey" PRIMARY KEY (username, fid, year)
);

CREATE TABLE IF NOT EXISTS public."teacher"
(
    username varchar NOT NULL,
    name varchar NOT NULL,
    CONSTRAINT "teacher_pkey" PRIMARY KEY (username)
);

CREATE TABLE IF NOT EXISTS public."user"
(
    username varchar NOT NULL,
    password varchar NOT NULL,
    role varchar NOT NULL,
    CONSTRAINT "user_pkey" PRIMARY KEY (username)
);

ALTER TABLE IF EXISTS public."course"
    ADD CONSTRAINT "course_fid_fkey" FOREIGN KEY (fid)
    REFERENCES public."faculty" (fid) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS fid_fk
    ON public."course"(fid);


ALTER TABLE IF EXISTS public."course"
    ADD CONSTRAINT "course_teacher_fkey" FOREIGN KEY (teacher)
    REFERENCES public."teacher" (username) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."faculty"
    ADD CONSTRAINT "faculty_chief_fkey" FOREIGN KEY (chief)
    REFERENCES public."teacher" (username) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."grade"
    ADD CONSTRAINT "grade_cid_fkey" FOREIGN KEY (cid)
    REFERENCES public."course" (cid) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."grade"
    ADD CONSTRAINT "grade_username_fkey" FOREIGN KEY (username)
    REFERENCES public."student" (username) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."group"
    ADD CONSTRAINT "group_faculty_fkey" FOREIGN KEY (faculty)
    REFERENCES public."faculty" (fid) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."optional course"
    ADD CONSTRAINT "optional course_username_fkey" FOREIGN KEY (username)
    REFERENCES public."teacher" (username) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."optional course"
    ADD CONSTRAINT cid_fk FOREIGN KEY (cid)
    REFERENCES public."course" (cid) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS "optional course_pkey"
    ON public."optional course"(cid);


ALTER TABLE IF EXISTS public."optional course enrollment"
    ADD CONSTRAINT "optional course enrollment_cid_fkey" FOREIGN KEY (cid)
    REFERENCES public."optional course" (cid) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."optional course enrollment"
    ADD CONSTRAINT "optional course enrollment_username_fkey" FOREIGN KEY (username)
    REFERENCES public."student" (username) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS "optional course enrollment_pkey"
    ON public."optional course enrollment"(username);


ALTER TABLE IF EXISTS public."staff"
    ADD CONSTRAINT "staff_username_fkey" FOREIGN KEY (username)
    REFERENCES public."user" (username) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS "staff_pkey"
    ON public."staff"(username);


ALTER TABLE IF EXISTS public."student"
    ADD CONSTRAINT "student_group1_fkey" FOREIGN KEY (group1)
    REFERENCES public."group" (gid) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."student"
    ADD CONSTRAINT "student_group2_fkey" FOREIGN KEY (group2)
    REFERENCES public."group" (gid) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."student"
    ADD CONSTRAINT "student_username_fkey" FOREIGN KEY (username)
    REFERENCES public."user" (username) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS "student_pkey"
    ON public."student"(username);


ALTER TABLE IF EXISTS public."studentenrollment "
    ADD CONSTRAINT fid_fk FOREIGN KEY (fid)
    REFERENCES public."faculty" (fid) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS fki_fid_fk
    ON public."studentenrollment "(fid);


ALTER TABLE IF EXISTS public."studentenrollment "
    ADD CONSTRAINT username_fk FOREIGN KEY (username)
    REFERENCES public."student" (username) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."teacher"
    ADD CONSTRAINT "teacher_username_fkey" FOREIGN KEY (username)
    REFERENCES public."user" (username) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS "teacher_pkey"
    ON public."teacher"(username);

END;